/*!
 * jquery.yoxview v1.1
 * jQuery image gallery viewer
 * http://yoxigen.com/yoxview
 *
 * Copyright (c) 2010 Yossi Kolesnicov
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Date: 18th March, 2010
 * Version : 1.1
 */
var yoxviewApi; (function(i){var m=false,l;i.yoxviewUnload=function(){if(yoxviewApi!=undefined){yoxviewApi.unload();delete yoxviewApi}};i(window).unload(function(){i.yoxviewUnload()});i.fn.yoxviewUnload=function(){jQuery.each(this,function(s,t){i(t).find("a:has(img)").unbind("click.yoxview")});return this};i.fn.yoxview=function(s,t){if(this.length==0)return this;if(l==undefined)l=typeof _yoxviewPath!="undefined"?_yoxviewPath:getYoxviewPath();this.loadLanguage=function(k,p){var y=this;if(yoxviewLanguages[k]==undefined){yoxviewLanguages[k]= {};i.ajax({url:l+"lang/"+k+".js",async:false,dataType:"json",success:function(z){yoxviewLanguages[k]=z;y.loadDataSource(A.dataSource,p)}})}else y.loadDataSource(A.dataSource,p)};this.loadDataSource=function(k,p){var y=this;yoxviewDataSources[k]==undefined?i.ajax({url:B.dataFolder+k+".js",async:false,dataType:"script",success:function(z){eval(z);eval("yoxviewDataSources['"+k+"'] = new yoxview_"+k+"();");p(y)},error:function(z,aa,I){console.log(z,aa,I)}}):p(y)};var B=i.extend({backgroundColor:"#000", backgroundOpacity:0.8,playDelay:3E3,popupMargin:20,infoBackOpacity:0.5,infoBackColor:"Black",imagesFolder:l+"images/",dataFolder:l+"data/",langFolder:l+"lang/",cacheImagesInBackground:true,displayImageTitleByDefault:true,titleDisplayDuration:2E3,titlePadding:6,buttonsFadeTime:500,loopPlay:true,isRTL:false,lang:"en",titleAttribute:"title",autoPlay:false,showBarsOnOpen:true,showButtonsOnOpen:true,renderButtons:true,renderMenu:true},s),A=i.extend({images:null,dataSource:"thumbnails",dataSourceOptions:{}, onLoadBegin:null,onLoadComplete:null,onLoadError:null,onNoData:null},t);if(m)this.loadLanguage(B.lang,function(k){yoxviewApi.AddViews(k,B,A)});else{m=true;this.loadLanguage(B.lang,function(k){yoxviewApi=new YoxView(k,B,A)})}return this}})(jQuery);function ImageDimensions(i,m){this.Width=i;this.Height=m}var yoxviewLanguages=[],yoxviewDataSources=[]; function YoxView(i,m,l){function s(){if(g!=undefined){g.parent().remove();C=q=Q=F=g=undefined;J=r=0}ba()}function t(a){a=$(a).data("yoxview");if(R==undefined||ma!=a.viewIndex){D=a.images;j=D.length;ma=a.viewIndex;R=new Array(j);var b=false;if(a.options!=undefined&&!ca(c,a.options)){c=a.options;b=true}else if(a.options==undefined&&!ca(c,da)){c=da;b=true}else if(F!=undefined&&j==1||g!=undefined&&F==undefined&&j>0)b=true;b&&s()}}function B(a,b,d,f){a=$(a);a.data("yoxview",{viewIndex:b});if(f.images!= null){f=f.images;G=$(a.find("a:has(img)")[0]);G.data("yoxview",{viewIndex:b}).bind("click.yoxview",function(){e.openGallery($(this).data("yoxview").viewIndex);return false})}else f=yoxviewDataSources[f.dataSource].getImagesData(e,a,d,f);a.data("yoxview").images=f;if(d!=c)a.data("yoxview").options=d}function A(a){var b;if(u.thumbnailImg!=undefined){b=u.thumbnailImg;G=b.parent()}else b=G.children("img:first");if(b!=undefined){a&&q!=undefined&&q.attr("src",b.attr("src"));ea=b.offset();o={width:b.width(), height:b.height(),top:ea.top-$(window).scrollTop(),left:ea.left}}}function k(a){a.css("opacity")==0&&a.stop().animate({opacity:0},c.buttonsFadeTime,y(a))}function p(a){a.stop().animate({opacity:0.6},c.buttonsFadeTime).oneTime(1E3,function(){$(this).stop().animate({opacity:0},c.buttonsFadeTime)})}function y(a){$(a).stop().animate({opacity:0.5},c.buttonsFadeTime)}function z(a){evt=a?a:window.event;return pK=a?a.keyCode:window.event.keyCode}function aa(a){if(e!=undefined&&e.isOpen){a=z(a);if(a==39)return e.clickBtn(c.isRTL? e.prev:e.next,true);else if(a==37)return e.clickBtn(c.isRTL?e.next:e.prev,true);else if(a==32)return e.clickBtn(e.next,true);else if(a==27)return e.clickBtn(e.close,true);else if(a==13){e.play();return false}else if(a==36)return e.clickBtn(e.first,true);else if(a==35)return e.clickBtn(e.last,true);else if(a==72)return e.clickBtn(e.help,false)}return true}function I(a,b,d,f){var h=$("<a>",{href:"#",click:function(){return e.clickBtn(d,f)}});$("<span>"+b+"</span>").css("opacity","0").appendTo(h);h.append(na(a, b,"18","16")).hover(function(){$(this).stop().animate({top:"8px"},"fast").find("span").stop().animate({opacity:1},"fast")},function(){$(this).stop().animate({top:"0"},"fast").find("span").stop().animate({opacity:0},"fast")});return h}function oa(a,b,d){var f=new Image;f.src=c.imagesFolder+b+".png";d=$("<a>",{css:{background:"url("+f.src+") no-repeat "+b+" center",opacity:"0",outline:"0"},className:"yoxview_ctlBtn",title:d,href:"#",click:function(){this.blur();return e.clickBtn(a,true)}});d.css(b, "0");return d}function ba(){n=yoxviewLanguages[c.lang];g=$("<div>",{id:"yoxview"});g.appendTo($(parent.document.body));q=$("<img />",{className:"yoxview_fadeImg",css:{"z-index":"2"}});g.append(q[0]);C=$("<img />",{className:"yoxview_fadeImg",css:{display:"none","z-index":"1"}});g.append(C[0]);var a=j==1;if(c.renderMenu!==false){var b=$("<div>",{id:"yoxview_popupMenuPanel",className:"yoxview_popupBarPanel yoxview_top",css:{opacity:"0"}}),d=$("<div>",{id:"yoxview_popupMenu",className:"yoxview_popupBar", css:{opacity:"0.8"}});(new Image).src=c.imagesFolder+"menu_back.png";var f=I("help.png",n.Help,e.help,false),h=I("play.png",n.Slideshow,e.play,false);d.append(I("close.png",n.Close,e.close,true),f,h);if(a){h.css("display","none");f.css("display","none");d.css("background-position","95px 0")}d.find("a:last-child").attr("class","last");b.append(d).appendTo(g)}if(c.renderButtons!==false&&!a){F=oa(e.prev,c.isRTL?"right":"left",n.PrevImage);F.appendTo(g);Q=oa(e.next,c.isRTL?"left":"right",n.NextImage); Q.appendTo(g)}fa=g.find(".yoxview_ctlBtn");S=$("<div>",{id:"yoxview_ajaxLoader",className:"yoxview_notification",css:{opacity:0}});S.append(na("popup_ajax_loader.gif",n.Loading,"32","32")).appendTo(g);jQuery.each(["play","pause","first","last"],function(){var T=$("<img />",{className:"yoxview_notification",alt:this,src:c.imagesFolder+"popup_"+this+".png",css:{opacity:0}});T.appendTo(g);K[this]=T});E=$("<div>",{id:"yoxview_helpPanel",href:"#",title:n.CloseHelp,css:{background:"url("+c.imagesFolder+ "help_panel.png) no-repeat center top",direction:n.Direction,opacity:"0"},click:function(){return e.clickBtn(e.help,false)}});a=document.createElement("h1");a.innerHTML=n.Help.toUpperCase();b=document.createElement("p");b.innerHTML=n.HelpText;d=document.createElement("span");d.id="yoxview_closeHelp";d.innerHTML=n.CloseHelp;E.append(a).append(b).append(d).appendTo(g);v=$("<div>",{id:"yoxview_popupInfo",className:"yoxview_popupBarPanel yoxview_bottom"});ga=$("<div>",{className:"yoxview_popupBar yoxview_bottom", css:{background:c.infoBackColor,opacity:c.infoBackOpacity,"z-index":"1",padding:c.titlePadding+"px 0","min-height":ha}});ga.appendTo(v);U=$("<h1>",{className:"yoxview_popupBar",css:{"z-index":"2",bottom:c.titlePadding,opacity:"1"}});U.appendTo(v);ia=$("<span>",{css:{opacity:"1"}});ia.appendTo(v);g.append(v);a=$("<div>",{id:"yoxview_popupWrap",css:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",display:"none","z-index":"100"}});g.wrap(a);$("<div>",{css:{position:"fixed",height:"100%", width:"100%",top:"0",left:"0",background:c.backgroundColor,"z-index":"1",opacity:c.backgroundOpacity},click:function(){return e.clickBtn(e.close,true)}}).appendTo(g.parent());c.buttonsFadeTime!=0&&fa.hover(function(){$(this).stop().animate({opacity:0.5},c.buttonsFadeTime)},function(){$(this).stop().animate({opacity:0},c.buttonsFadeTime)});L=g.children(".yoxview_popupBarPanel");L.hover(function(){$(this).stop().animate({opacity:1},c.buttonsFadeTime)},function(){$(this).stop().animate({opacity:0},c.buttonsFadeTime)})} function M(a){if(R[a])a<j-1&&M(a+1);else{J=a;pa.src=D[a].src}}function na(a,b,d,f){var h=document.createElement("img");$(h).attr({src:c.imagesFolder+a,alt:b,width:d,height:f});return h}function va(){ja=true;S.stop().stopTime().oneTime(c.buttonsFadeTime,function(){$(this).animate({opacity:0.5},c.buttonsFadeTime)})}function wa(){ja=false;S.stop().stopTime().animate({opacity:0},c.buttonsFadeTime)}function qa(){w||va();if(c.images==null)G=u.thumbnailImg.parent();ka.src=u.src}function ra(a,b,d,f){var h= new ImageDimensions(a,b);if(a>d){h.Height=Math.round(d/a*b);h.Width=d}if(h.Height>f){h.Width=Math.round(f/h.Height*h.Width);h.Height=f}return h}function la(a,b,d,f,h){g.stop().animate({width:a,height:b,top:d,left:f},"slow",h)}function V(){if(j!=1){w=true;if(r<j-1)g.oneTime(c.playDelay,"play",function(){e.next()});else c.loopPlay?g.oneTime(c.playDelay,"play",function(){e.select(0,null)}):N()}}function N(){g.stopTime("play");w=false}function sa(){var a=$(parent.window).width(),b=$(parent.window).height(); return{height:b,width:a,usableHeight:b-c.popupMargin*2,usableWidth:a-c.popupMargin*2}}function ta(){var a=U.outerHeight();if(a<ha)a=ha;ga.animate({height:a},"fast")}function ca(a,b){function d(T){var ua=0;for(var xa in T)xa!=null&&ua++;return ua}if(d(a)!=d(b))return false;for(var f in a){if(typeof a[f]!=typeof b[f])return false;if(typeof a[f]=="function"||typeof a[f]=="object"){var h=ca(a[f],b[f]);if(!h)return h}else if(a[f]!=b[f])return false}return true}var e=this,da=m,c=da,n={},W=[],ma=0,D,j=0, g,r=0,u,G,ea,o,X=true,q,C,F,Q,S,E,v,U,ha=28-2*c.titlePadding,ga,L,fa,ia,w=false,O=false,K=[],ka=new Image,pa=new Image,J=0,R,H=this.isOpen=false,P,ja=false,Y;this.AddViews=function(a,b,d){var f=P!=undefined;jQuery.each(a,function(){B(this,W.length,b,d);W.push(this);if(P==undefined){var h=$(this).data("yoxview").images;if(h&&h.length!=0)P=this}});if(!f&&P!=undefined){t(P);ba();b.cacheImagesInBackground&&j!=0&&M(0);f=true}};this.SetImages=function(a){D=a;j=D.length};this.openGallery=function(a,b,d){if(typeof a== "function"){d=a;a=b=0}else if(typeof b=="function"){d=b;b=0}a=a||0;b=b||0;t(W[a]);g==undefined&&j!=0&&ba();c.cacheImagesInBackground&&M(b);this.selectImage(b);g.parent().fadeIn("slow");if(d)Y=d;return false};this.selectImage=function(a){u=D[a];A(true);G.blur();if(!X){q.css({display:"block","z-index":"1",width:o.width+"px",height:o.height+"px"});C.css({display:"none","z-index":"2"});X=true}g.css({width:o.width+"px",height:o.height+"px",top:o.top+"px",left:o.left+"px"});this.select(a);this.isOpen=true}; this.refresh=function(){(O=w)&&N();qa(r);O&&V()};this.select=function(a,b){if(!H){if(a<0)a=j-1;else if(a==j)a=0;!w&&b&&k(b);u=D[a];r=a;qa(r)}};this.prev=function(){this.select(r-1,$(F));return false};this.next=function(){this.select(r+1,$(Q));return false};this.first=function(){p(K.first);this.select(0);return false};this.last=function(){p(K.last);this.select(j-1);return false};this.play=function(){if(j!=1)if(w){p(K.pause);N()}else{p(K.play);V()}};this.close=function(){this.closeHelp();A(false);la(o.width, o.height,o.top,o.left);g.parent().fadeOut(e.clear);L.css("display","none");c.onClose&&c.onClose();H=this.isOpen=false};this.help=function(){if(this.isOpen)E.css("display")=="none"?E.css("display","block").stop().animate({opacity:0.8},c.buttonsFadeTime):this.closeHelp()};this.closeHelp=function(){E.css("display")!="none"&&E.stop().animate({opacity:0},c.buttonsFadeTime,function(){E.css("display","none")})};this.clickBtn=function(a,b){b&&w&&N();a.call(this);return false};this.AddViews(i,c,l);document.onkeydown= aa;window.onresize=function(){e.isOpen&&e.resize()};$(pa).load(function(){R[J]=true;J<j-1&&M(J+1)});var x=q,Z=C;this.resize=function(){if(w){O=true;N()}var a=sa(),b=x.data("Data").maxSize;b=ra(b.Width,b.Height,a.usableWidth,a.usableHeight);x.css({width:"100%",height:"100%"});var d=Math.round((a.height-b.Height)/2);a=Math.round((a.width-b.Width)/2);H=true;la(b.Width,b.Height,d,a,function(){var f=g.width(),h=g.height();x.css({width:f+"px",height:h+"px"});H=false;if(O){V();O=false}})};$(ka).load(function(){if(this.width!= 0){if(q.css("z-index")==1){x=q;Z=C}else{x=C;Z=q}x.data("Data",{maxSize:new ImageDimensions(this.width,this.height)});var a=sa(),b=ra(this.width,this.height,a.usableWidth,a.usableHeight);U.html(u.title);j>1&&ia.html(r+1+"/"+j);x.attr({src:this.src,title:u.title}).css({width:b.Width+"px",height:b.Height+"px"});var d=Math.round((a.height-b.Height)/2);a=Math.round((a.width-b.Width)/2);ja&&wa();H=true;la(b.Width,b.Height,d,a,function(){if(X){L.css("display","block");c.showButtonsOnOpen&&fa.animate({opacity:0.5}, 1500).oneTime(1700,function(){c.buttonsFadeTime!=0&&$(this).animate({opacity:0},1500)});c.showBarsOnOpen&&L.animate({opacity:1},1500).oneTime(1700,function(){$(this).animate({opacity:0},1500)});ta();c.autoPlay&&e.play();c.onOpen&&c.onOpen();if(Y){Y();Y=undefined}X=false}H=false});x.css("z-index","2");Z.css("z-index","1");x.fadeIn("slow",function(){Z.css("display","none");if(u.title!=""){v.css({display:"block"});ta();c.displayImageTitleByDefault&&v.stop().stopTime().animate({opacity:1},500,function(){$(this).oneTime(c.titleDisplayDuration, function(){$(this).stop().animate({opacity:0},500)})})}else v.css("display")!="none"&&v.fadeOut(c.buttonsFadeTime);if(j>1){r<j-1&&c.cacheImagesInBackground&&M(r+1);w&&V()}});ka.src=""}});this.unload=function(){jQuery.each(W,function(a,b){$(b).find("a:has(img)").unbind("click.yoxview")});if(g!=undefined){g.parent().remove();g=undefined}}}function createThumbnail(i,m,l,s,t){i=$("<a>",{href:i});t&&i.data("yoxview",{viewIndex:t});m=$("<img>",{src:s,alt:m,title:l}).appendTo(i);return i} function getYoxviewPath(){for(var i=document.getElementsByTagName("script"),m=/(.*\/)yoxview.*/i,l=0;l<i.length;l++){var s=i[l].src;if(s.match(m))return s.match(m)[1]}return null};